<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Predict Concentration Using Calibration — inversePredictCalibrate • EnvStats</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Predict Concentration Using Calibration — inversePredictCalibrate"><meta property="og:description" content="Predict concentration using a calibration line (or curve) and inverse regression."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EnvStats</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/alexkowa/EnvStats/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Predict Concentration Using Calibration</h1>
    
    <div class="hidden name"><code>inversePredictCalibrate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Predict concentration using a calibration line (or curve) and inverse regression.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">inversePredictCalibrate</span><span class="op">(</span><span class="va">object</span>, obs.y <span class="op">=</span> <span class="cn">NULL</span>, 
    n.points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">obs.y</span><span class="op">)</span>, <span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">obs.y</span><span class="op">)</span><span class="op">)</span>, 
    intervals <span class="op">=</span> <span class="cn">FALSE</span>, coverage <span class="op">=</span> <span class="fl">0.99</span>, simultaneous <span class="op">=</span> <span class="cn">FALSE</span>, 
    individual <span class="op">=</span> <span class="cn">FALSE</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>object</dt>
<dd><p>an object of class <code>"calibrate"</code> that is the result of calling the function <br><code><a href="calibrate.html">calibrate</a></code>.</p></dd>
<dt>obs.y</dt>
<dd><p>optional numeric vector of observed values for the machine signal.  
  The default value is <code>obs.y=NULL</code>, in which case <code>obs.y</code> is set equal to 
  a vector of values (of length <code>n.points</code>) ranging from the minimum to the maximum of 
  the fitted values from the calibrate object.</p></dd>
<dt>n.points</dt>
<dd><p>optional integer indicating the number of points at which to predict concentrations 
  (i.e., perform inverse regression). The default value is <code>n.points=100</code>. 
  This argument is ignored when <code>obs.y</code> is supplied.</p></dd>
<dt>intervals</dt>
<dd><p>optional logical scalar indicating whether to compute confidence intervals for 
  the predicted concentrations. The default value is <code>intervals=FALSE</code>.</p></dd>
<dt>coverage</dt>
<dd><p>optional numeric scalar between 0 and 1 indicating the confidence level associated with 
  the confidence intervals for the predicted concentrations. 
  The default value is <code>coverage=0.99</code>.</p></dd>
<dt>simultaneous</dt>
<dd><p>optional logical scalar indicating whether to base the confidence intervals 
  for the predicted values on simultaneous or non-simultaneous prediction limits. 
  The default value is <code>simultaneous=FALSE</code>.</p></dd>
<dt>individual</dt>
<dd><p>optional logical scalar indicating whether to base the confidence intervals for the predicted values 
  on prediction limits for the mean (<code>individual=FALSE</code>) or prediction limits for 
  an individual observation (<code>individual=TRUE</code>).  
  The default value is <code>individual=FALSE</code>.</p></dd>
<dt>trace</dt>
<dd><p>optional logical scalar indicating whether to print out (trace) the progress of 
  the inverse prediction for each of the specified values of <code>obs.y</code>. 
  The default value is <code>trace=FALSE</code>.</p></dd>
</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>A simple and frequently used calibration model is a straight line where the 
  response variable \(S\) denotes the signal of the machine and the 
  predictor variable \(C\) denotes the true concentration in the physical 
  sample.  The error term is assumed to follow a normal distribution with 
  mean 0.  Note that the average value of the signal for a blank (\(C = 0\)) 
  is the intercept.  Other possible calibration models include higher order 
  polynomial models such as a quadratic or cubic model.</p>
<p>In a typical setup, a small number of samples (e.g., \(n = 6\)) with known 
  concentrations are measured and the signal is recorded.  A sample with no 
  chemical in it, called a blank, is also measured.  (You have to be careful 
  to define exactly what you mean by a “blank.”  A blank could mean 
  a container from the lab that has nothing in it but is prepared in a similar 
  fashion to containers with actual samples in them.  Or it could mean a 
  field blank: the container was taken out to the field and subjected to the 
  same process that all other containers were subjected to, except a physical 
  sample of soil or water was not placed in the container.)  Usually, 
  replicate measures at the same known concentrations are taken.  
  (The term “replicate” must be well defined to distinguish between for 
  example the same physical samples that are measured more than once vs. two 
  different physical samples of the same known concentration.)</p>
<p>The function <code><a href="calibrate.html">calibrate</a></code> initially fits a linear calibration 
  line or curve.  Once the calibration line is fit, samples with unknown 
  concentrations are measured and their signals are recorded.  In order to 
  produce estimated concentrations, you have to use inverse regression to 
  map the signals to the estimated concentrations.  We can quantify the 
  uncertainty in the estimated concentration by combining inverse regression 
  with prediction limits for the signal \(S\).</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p>A numeric matrix containing the results of the inverse calibration. 
  The first two columns are labeled <code>obs.y</code> and <code>pred.x</code> containing 
  the values of the argument <code>obs.y</code> and the predicted values of <code>x</code>  (the concentration), respectively. If <code>intervals=TRUE</code>, then the matrix also 
  contains the columns <code>lpl.x</code> and <code>upl.x</code> corresponding to the lower and 
  upper prediction limits for <code>x</code>.  Also, if <code>intervals=TRUE</code>, then the 
  matrix has the attributes <code>coverage</code> (the value of the argument <code>coverage</code>) 
  and <code>simultaneous</code> (the value of the argument <code>simultaneous</code>).</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Currie, L.A. (1997). Detection: International Update, and Some Emerging Di-Lemmas Involving Calibration, the Blank, and Multiple Detection Decisions. 
  <em>Chemometrics and Intelligent Laboratory Systems</em> <b>37</b>, 151--181.</p>
<p>Draper, N., and H. Smith. (1998). <em>Applied Regression Analysis</em>. Third Edition. 
  John Wiley and Sons, New York, Chapter 3 and p.335.</p>
<p>Hubaux, A., and G. Vos. (1970). Decision and Detection Limits for Linear Calibration Curves. 
  <em>Annals of Chemistry</em> <b>42</b>, 849--855.</p>
<p>Millard, S.P., and N.K. Neerchal. (2001). <em>Environmental Statistics with S-PLUS</em>. 
  CRC Press, Boca Raton, FL, pp.562--575.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Steven P. Millard (<a href="mailto:EnvStats@ProbStatInfo.com">EnvStats@ProbStatInfo.com</a>)</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>Almost always the process of determining the concentration of a chemical in 
  a soil, water, or air sample involves using some kind of machine that 
  produces a signal, and this signal is related to the concentration of the 
  chemical in the physical sample. The process of relating the machine signal 
  to the concentration of the chemical is called <strong>calibration</strong> 
  (see <code><a href="calibrate.html">calibrate</a></code>). Once calibration has been performed, 
  estimated concentrations in physical samples with unknown concentrations 
  are computed using inverse regression.  The uncertainty in the process used 
  to estimate the concentration may be quantified with decision, detection, 
  and quantitation limits.</p>
<p>In practice, only the point estimate of concentration is reported (along 
  with a possible qualifier), without confidence bounds for the true 
  concentration \(C\). This is most unfortunate because it gives the 
  impression that there is no error associated with the reported concentration. 
  Indeed, both the International Organization for Standardization (ISO) and 
  the International Union of Pure and Applied Chemistry (IUPAC) recommend 
  always reporting both the estimated concentration and the uncertainty 
  associated with this estimate (Currie, 1997).</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="pointwise.html">pointwise</a></code>, <code><a href="calibrate.html">calibrate</a></code>, <code><a href="detectionLimitCalibrate.html">detectionLimitCalibrate</a></code>, <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in">  <span class="co"># The data frame EPA.97.cadmium.111.df contains calibration data </span></span>
<span class="r-in">  <span class="co"># for cadmium at mass 111 (ng/L) that appeared in </span></span>
<span class="r-in">  <span class="co"># Gibbons et al. (1997b) and were provided to them by the U.S. EPA.  </span></span>
<span class="r-in">  <span class="co"># Here we </span></span>
<span class="r-in">  <span class="co"># 1. Display a plot of these data along with the fitted calibration </span></span>
<span class="r-in">  <span class="co">#    line and 99% non-simultaneous prediction limits. </span></span>
<span class="r-in">  <span class="co"># 2. Then based on an observed signal of 60 from a sample with </span></span>
<span class="r-in">  <span class="co">#    unknown concentration, we use the calibration line to estimate </span></span>
<span class="r-in">  <span class="co">#    the true concentration and use the prediction limits to compute </span></span>
<span class="r-in">  <span class="co">#    confidence bounds for the true concentration. </span></span>
<span class="r-in">  <span class="co"># An observed signal of 60 results in an estimated value of cadmium </span></span>
<span class="r-in">  <span class="co"># of 59.97 ng/L and a confidence interval of [53.83, 66.15]. </span></span>
<span class="r-in">  <span class="co"># See Millard and Neerchal (2001, pp.566-569) for more details on </span></span>
<span class="r-in">  <span class="co"># this example.</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="va">Cadmium</span> <span class="op">&lt;-</span> <span class="va">EPA.97.cadmium.111.df</span><span class="op">$</span><span class="va">Cadmium</span> </span>
<span class="r-in"></span>
<span class="r-in">  <span class="va">Spike</span> <span class="op">&lt;-</span> <span class="va">EPA.97.cadmium.111.df</span><span class="op">$</span><span class="va">Spike</span> </span>
<span class="r-in"></span>
<span class="r-in">  <span class="va">calibrate.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="calibrate.html">calibrate</a></span><span class="op">(</span><span class="va">Cadmium</span> <span class="op">~</span> <span class="va">Spike</span>, </span>
<span class="r-in">    data <span class="op">=</span> <span class="va">EPA.97.cadmium.111.df</span><span class="op">)</span> </span>
<span class="r-in"></span>
<span class="r-in">  <span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Spike <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">Spike</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Spike</span><span class="op">)</span>, </span>
<span class="r-in">    length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="va">pred.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="predict.html">predict</a></span><span class="op">(</span><span class="va">calibrate.list</span>, newdata <span class="op">=</span> <span class="va">newdata</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span class="r-in"></span>
<span class="r-in">  <span class="va">pointwise.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="pointwise.html">pointwise</a></span><span class="op">(</span><span class="va">pred.list</span>, coverage <span class="op">=</span> <span class="fl">0.99</span>, </span>
<span class="r-in">    individual <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Spike</span>, <span class="va">Cadmium</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">pointwise.list</span><span class="op">$</span><span class="va">lower</span><span class="op">)</span>, </span>
<span class="r-in">    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pointwise.list</span><span class="op">$</span><span class="va">upper</span><span class="op">)</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"True Concentration (ng/L)"</span>, </span>
<span class="r-in">    ylab <span class="op">=</span> <span class="st">"Observed Concentration (ng/L)"</span><span class="op">)</span> </span>
<span class="r-in"></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="va">calibrate.list</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span> </span>
<span class="r-in"></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">$</span><span class="va">Spike</span>, <span class="va">pointwise.list</span><span class="op">$</span><span class="va">lower</span>, lty<span class="op">=</span><span class="fl">8</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span> </span>
<span class="r-in"></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">$</span><span class="va">Spike</span>, <span class="va">pointwise.list</span><span class="op">$</span><span class="va">upper</span>, lty<span class="op">=</span><span class="fl">8</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span> </span>
<span class="r-in"></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Calibration Line and 99% Prediction Limits"</span>, </span>
<span class="r-in">    <span class="st">"for US EPA Cadmium 111 Data"</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span> </span>
<span class="r-plt img"><img src="inversePredictCalibrate-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"> </span>
<span class="r-in">  <span class="co"># Now estimate the true concentration based on </span></span>
<span class="r-in">  <span class="co"># an observed signal of 60 ng/L. </span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="fu">inversePredictCalibrate</span><span class="op">(</span><span class="va">calibrate.list</span>, obs.y <span class="op">=</span> <span class="fl">60</span>, </span>
<span class="r-in">    intervals <span class="op">=</span> <span class="cn">TRUE</span>, coverage <span class="op">=</span> <span class="fl">0.99</span>, individual <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      obs.y   pred.x   lpl.x    upl.x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    60 59.97301 53.8301 66.15422</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"coverage")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"simultaneous")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-in"></span>
<span class="r-in">  <span class="co">#     obs.y   pred.x   lpl.x    upl.x </span></span>
<span class="r-in">  <span class="co">#[1,]    60 59.97301 53.8301 66.15422 </span></span>
<span class="r-in">  <span class="co">#attr(, "coverage"): </span></span>
<span class="r-in">  <span class="co">#[1] 0.99 </span></span>
<span class="r-in">  <span class="co">#attr(, "simultaneous"): </span></span>
<span class="r-in">  <span class="co">#[1] FALSE</span></span>
<span class="r-in"></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">Cadmium</span>, <span class="va">Spike</span>, <span class="va">calibrate.list</span>, <span class="va">newdata</span>, <span class="va">pred.list</span>, <span class="va">pointwise.list</span><span class="op">)</span> </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Steven P. Millard, Alexander Kowarik.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

