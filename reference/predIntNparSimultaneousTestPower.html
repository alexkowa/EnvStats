<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Probability That at Least One Set of Future Observations Violates the Given Rule Based on a Nonparametric Simultaneous Prediction Interval — predIntNparSimultaneousTestPower • EnvStats</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Probability That at Least One Set of Future Observations Violates the Given Rule Based on a Nonparametric Simultaneous Prediction Interval — predIntNparSimultaneousTestPower"><meta property="og:description" content="Compute the probability that at least one set of future observations violates the
  given rule based on a nonparametric simultaneous prediction interval for the next
  \(r\) future sampling occasions.  The three possible rules are:
  \(k\)-of-\(m\), California, or Modified California.  The probability is based
  on assuming the true distribution of the observations is normal."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EnvStats</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/alexkowa/EnvStats/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Probability That at Least One Set of Future Observations Violates the Given Rule Based on a Nonparametric Simultaneous Prediction Interval</h1>

    <div class="hidden name"><code>predIntNparSimultaneousTestPower.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute the probability that at least one set of future observations violates the
  given rule based on a nonparametric simultaneous prediction interval for the next
  \(r\) future sampling occasions.  The three possible rules are:
  \(k\)-of-\(m\), California, or Modified California.  The probability is based
  on assuming the true distribution of the observations is <a href="https://rdrr.io/r/stats/Normal.html" class="external-link">normal</a>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">predIntNparSimultaneousTestPower</span><span class="op">(</span><span class="va">n</span>, n.median <span class="op">=</span> <span class="fl">1</span>, k <span class="op">=</span> <span class="fl">1</span>, m <span class="op">=</span> <span class="fl">2</span>, r <span class="op">=</span> <span class="fl">1</span>, </span>
<span>    rule <span class="op">=</span> <span class="st">"k.of.m"</span>, lpl.rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">pi.type</span> <span class="op">==</span> <span class="st">"upper"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>    n.plus.one.minus.upl.rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">pi.type</span> <span class="op">==</span> <span class="st">"lower"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>    delta.over.sigma <span class="op">=</span> <span class="fl">0</span>, pi.type <span class="op">=</span> <span class="st">"upper"</span>, r.shifted <span class="op">=</span> <span class="va">r</span>,  </span>
<span>    method <span class="op">=</span> <span class="st">"approx"</span>, NMC <span class="op">=</span> <span class="fl">100</span>, ci <span class="op">=</span> <span class="cn">FALSE</span>, ci.conf.level <span class="op">=</span> <span class="fl">0.95</span>, </span>
<span>    integrate.args.list <span class="op">=</span> <span class="cn">NULL</span>, evNormOrdStats.method <span class="op">=</span> <span class="st">"royston"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <p></p>
<dl><dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>vector of positive integers specifying the sample sizes.
  Missing (<code>NA</code>), undefined (<code>NaN</code>), and infinite (<code>Inf</code>, <code>-Inf</code>)
  values are not allowed.</p></dd>

  <dt id="arg-n-median">n.median<a class="anchor" aria-label="anchor" href="#arg-n-median"></a></dt>
<dd><p>vector of positive odd integers specifying the sample size associated with the
  future medians.  The default value is <code>n.median=1</code> (i.e., individual
  observations).  Note that all future medians must be based on the same
  sample size.</p></dd>

  <dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>for the \(k\)-of-\(m\) rule (<code>rule="k.of.m"</code>), a vector of positive integers
  specifying the minimum number of observations (or medians) out of \(m\)
  observations (or medians) (all obtained on one future sampling “occassion”)
  the prediction interval should contain.
  The default value is <code>k=1</code>.  This argument is ignored when the argument
  <code>rule</code> is not equal to <code>"k.of.m"</code>.</p></dd>

  <dt id="arg-m">m<a class="anchor" aria-label="anchor" href="#arg-m"></a></dt>
<dd><p>vector of positive integers specifying the maximum number of future observations (or
  medians) on one future sampling “occasion”.
  The default value is <code>m=2</code>, except when <code>rule="Modified.CA"</code>, in which
  case this argument is ignored and <code>m</code> is automatically set equal to <code>4</code>.</p></dd>

  <dt id="arg-r">r<a class="anchor" aria-label="anchor" href="#arg-r"></a></dt>
<dd><p>vector of positive integers specifying the number of future sampling
  “occasions”.  The default value is <code>r=1</code>.</p></dd>

  <dt id="arg-rule">rule<a class="anchor" aria-label="anchor" href="#arg-rule"></a></dt>
<dd><p>character string specifying which rule to use.  The possible values are
  <code>"k.of.m"</code> (\(k\)-of-\(m\) rule; the default), <code>"CA"</code> (California rule),
  and <code>"Modified.CA"</code> (modified California rule).</p></dd>

  <dt id="arg-lpl-rank">lpl.rank<a class="anchor" aria-label="anchor" href="#arg-lpl-rank"></a></dt>
<dd><p>vector of non-negative integers indicating the rank of the order statistic to use for
  the lower bound of the prediction interval.  When <code>pi.type="lower"</code>, the
  default value is <code>lpl.rank=1</code> (implying the minimum value of <code>x</code> is used
  as the lower bound of the prediction interval).  When <code>pi.type="upper"</code>,
  the argument <code>lpl.rank</code> is set equal to <code>0</code>.</p></dd>

  <dt id="arg-n-plus-one-minus-upl-rank">n.plus.one.minus.upl.rank<a class="anchor" aria-label="anchor" href="#arg-n-plus-one-minus-upl-rank"></a></dt>
<dd><p>vector of non-negative integers related to the rank of the order statistic to use for
  the upper bound of the prediction interval.  A value of <code>n.plus.one.minus.upl.rank=1</code>
  (the default) means use the first largest value, and in general a value of <br><code>n.plus.one.minus.upl.rank=</code>\(i\) means use the \(i\)'th largest value.
  When <code>pi.type="lower"</code>, the argument <code>n.plus.one.minus.upl.rank</code> is set
  equal to <code>0</code>.</p></dd>

  <dt id="arg-delta-over-sigma">delta.over.sigma<a class="anchor" aria-label="anchor" href="#arg-delta-over-sigma"></a></dt>
<dd><p>numeric vector indicating the ratio \(\Delta/\sigma\).  The quantity
  \(\Delta\) (delta) denotes the difference between the mean of the population
  that was sampled to construct the prediction interval, and the mean of the
  population that will be sampled to produce the future observations.  The quantity
  \(\sigma\) (sigma) denotes the population standard deviation for both populations.
  The default value is <br><code>delta.over.sigma=0</code>.</p></dd>

  <dt id="arg-pi-type">pi.type<a class="anchor" aria-label="anchor" href="#arg-pi-type"></a></dt>
<dd><p>character string indicating what kind of prediction interval to compute.
  The possible values are <code>"two.sided"</code> (the default), <code>"lower"</code>, and
  <code>"upper"</code>.</p></dd>

  <dt id="arg-r-shifted">r.shifted<a class="anchor" aria-label="anchor" href="#arg-r-shifted"></a></dt>
<dd><p>vector of positive integers specifying the number of future sampling occasions for
  which the scaled mean is shifted by \(\Delta/\sigma\).  All values must be
  integeters between <code>1</code> and the corresponding element of <code>r</code>.
  The default value is <code>r.shifted=r</code>.</p></dd>

  <dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>character string indicating what method to use to compute the power.  The possible
  values are <code>"approx"</code> (approximation based on <br><code><a href="predIntNormSimultaneousTestPower.html">predIntNormSimultaneousTestPower</a></code>; the default) and
  <code>"simulate"</code> (Monte Carlo simulation).</p></dd>

  <dt id="arg-nmc">NMC<a class="anchor" aria-label="anchor" href="#arg-nmc"></a></dt>
<dd><p>positive integer indicating the number of Monte Carlo trials to run when <br><code>method="simulate"</code>.  The default value is <code>NMC=100</code>.</p></dd>

  <dt id="arg-ci">ci<a class="anchor" aria-label="anchor" href="#arg-ci"></a></dt>
<dd><p>logical scalar indicating whether to compute a confidence interval for the power
  when <code>method="simulate"</code>.  The default value is <code>ci=FALSE</code>.</p></dd>

  <dt id="arg-ci-conf-level">ci.conf.level<a class="anchor" aria-label="anchor" href="#arg-ci-conf-level"></a></dt>
<dd><p>numeric scalar between 0 and 1 indicating the confidence level associated with the
  confidence interval for the power.  The argument is ignored if <code>ci=FALSE</code>
  or <code>method="approx"</code>.</p></dd>

  <dt id="arg-integrate-args-list">integrate.args.list<a class="anchor" aria-label="anchor" href="#arg-integrate-args-list"></a></dt>
<dd><p>list of arguments to supply to the <code><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></code> function.  The default
  value is <code>NULL</code>.</p></dd>

  <dt id="arg-evnormordstats-method">evNormOrdStats.method<a class="anchor" aria-label="anchor" href="#arg-evnormordstats-method"></a></dt>
<dd><p>character string indicating which method to use in the call to
  <code><a href="evNormOrdStats.html">evNormOrdStatsScalar</a></code> when <code>method="approx"</code>.  The default
  value is <code>evNormOrdStats.method="royston"</code>.  See the DETAILS section for
  more information.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p><em>What is a Nonparametric Simultaneous Prediction Interval?</em> <br>
  A nonparametric prediction interval for some population is an interval on the real line
  constructed so that it will contain at least \(k\) of \(m\) future observations from
  that population with some specified probability \((1-\alpha)100\%\), where
  \(0 &lt; \alpha &lt; 1\) and \(k\) and \(m\) are some pre-specified positive integers
  and \(k \le m\).  The quantity \((1-\alpha)100\%\) is called
  the confidence coefficient or confidence level associated with the prediction
  interval.  The function <code><a href="predIntNpar.html">predIntNpar</a></code> computes a standard
  nonparametric prediction interval.</p>
<p>The function <code><a href="predIntNparSimultaneous.html">predIntNparSimultaneous</a></code> computes a nonparametric simultaneous
  prediction interval that will contain a certain number of future observations
  with probability \((1-\alpha)100\%\) for each of \(r\) future sampling
  “occasions”,
  where \(r\) is some pre-specified positive integer.  The quantity \(r\) may
  refer to \(r\) distinct future sampling occasions in time, or it may for example
  refer to sampling at \(r\) distinct locations on one future sampling occasion,
  assuming that the population standard deviation is the same at all of the \(r\)
  distinct locations.</p>
<p>The function <code><a href="predIntNparSimultaneous.html">predIntNparSimultaneous</a></code> computes a nonparametric simultaneous
  prediction interval based on one of three possible rules:</p><ul><li><p>For the \(k\)-of-\(m\) rule (<code>rule="k.of.m"</code>), at least \(k\) of
    the next \(m\) future observations will fall in the prediction
    interval with probability \((1-\alpha)100\%\) on each of the \(r\) future
    sampling occasions.  If obserations are being taken sequentially, for a particular
    sampling occasion, up to \(m\) observations may be taken, but once
    \(k\) of the observations fall within the prediction interval, sampling can stop.
    Note:  For this rule, when \(r=1\), the results of <code><a href="predIntNparSimultaneous.html">predIntNparSimultaneous</a></code>
    are equivalent to the results of <code><a href="predIntNpar.html">predIntNpar</a></code>.</p></li>
<li><p>For the California rule (<code>rule="CA"</code>), with probability
    \((1-\alpha)100\%\), for each of the \(r\) future sampling occasions, either
    the first observation will fall in the prediction interval, or else all of the next
    \(m-1\) observations will fall in the prediction interval. That is, if the first
    observation falls in the prediction interval then sampling can stop.  Otherwise,
    \(m-1\) more observations must be taken.</p></li>
<li><p>For the Modified California rule (<code>rule="Modified.CA"</code>), with probability
    \((1-\alpha)100\%\), for each of the \(r\) future sampling occasions, either the
    first observation will fall in the prediction interval, or else at least 2 out of
    the next 3 observations will fall in the prediction interval.  That is, if the first
    observation falls in the prediction interval then sampling can stop.  Otherwise, up
    to 3 more observations must be taken.</p></li>
</ul><p>Nonparametric simultaneous prediction intervals can be extended to using medians
  in place of single observations (USEPA, 2009, Chapter 19).  That is, you can
  create a nonparametric simultaneous prediction interval that will contain a
  specified number of medians (based on which rule you choose) on each of \(r\)
  future sampling occassions, where each each median is based on \(b\) individual
  observations.  For the function <code><a href="predIntNparSimultaneous.html">predIntNparSimultaneous</a></code>, the argument
  <code>n.median</code> corresponds to \(b\).
  <br></p>
<p><b>The Form of a Nonparametric Prediction Interval</b> <br>
  Let \(\underline{x} = x_1, x_2, \ldots, x_n\) denote a vector of \(n\)
  independent observations from some continuous distribution, and let
  \(x_{(i)}\) denote the the \(i\)'th order statistics in \(\underline{x}\).
  A two-sided nonparametric prediction interval is constructed as:
  $$[x_{(u)}, x_{(v)}] \;\;\;\;\;\; (1)$$
  where \(u\) and \(v\) are positive integers between 1 and \(n\), and
  \(u &lt; v\).  That is, \(u\) denotes the rank of the lower prediction limit, and
  \(v\) denotes the rank of the upper prediction limit.  To make it easier to write
  some equations later on, we can also write the prediction interval (1) in a slightly
  different way as:
  $$[x_{(u)}, x_{(n + 1 - w)}] \;\;\;\;\;\; (2)$$
  where
  $$w = n + 1 - v \;\;\;\;\;\; (3)$$
  so that \(w\) is a positive integer between 1 and \(n-1\), and
  \(u &lt; n+1-w\).  In terms of the arguments to the function <code>predIntNparSimultaneous</code>,
  the argument <code>lpl.rank</code> corresponds to \(u\), and the argument
  <code>n.plus.one.minus.upl.rank</code> corresponds to \(w\).</p>
<p>If we allow \(u=0\) and \(w=0\) and define lower and upper bounds as:
  $$x_{(0)} = lb \;\;\;\;\;\; (4)$$
  $$x_{(n+1)} = ub \;\;\;\;\;\; (5)$$
  then Equation (2) above can also represent a one-sided lower or one-sided upper
  prediction interval as well.  That is, a one-sided lower nonparametric prediction
  interval is constructed as:
  $$[x_{(u)}, x_{(n + 1)}] =  [x_{(u)}, ub] \;\;\;\;\;\; (6)$$
  and a one-sided upper nonparametric prediction interval is constructed as:
  $$[x_{(0)}, x_{(n + 1 - w)}]  = [lb, x_{(n + 1 - w)}] \;\;\;\;\;\; (7)$$
  Usually, \(lb = -\infty\) or \(lb = 0\) and \(ub = \infty\).</p>
<p><b>Note:</b>  For nonparametric simultaneous prediction intervals, only lower
  (<code>pi.type="lower"</code>) and upper (<code>pi.type="upper"</code>) prediction
  intervals are available.
  <br></p>
<p><b>Computing Power</b> <br>
  The "power" of the prediction interval is defined as the probability that
  at least one set of future observations violates the given rule based on a
  simultaneous prediction interval for the next \(r\) future sampling occasions,
  where the population for the future observations is allowed to differ from
  the population for the observations used to construct the prediction interval.</p>
<p>For the function <code>predIntNparSimultaneousTestPower</code>, power is computed assuming
  both the background and future the observations come from normal distributions with
  the same standard deviation, but the means of the distributions are allowed to differ.
  The quantity \(\Delta\) (upper case delta) denotes the difference between the
  mean of the population that was sampled to construct the prediction interval, and
  the mean of the population that will be sampled to produce the future observations.
  The quantity \(\sigma\) (sigma) denotes the population standard deviation of both
  of these populations.  The argument <code>delta.over.sigma</code> corresponds to the
  quantity \(\Delta/\sigma\).</p>
<p><em>Approximate Power</em> (<code>method="approx"</code>) <br>
  Based on Gansecki (2009), the power of a nonparametric simultaneous prediction
  interval when the underlying observations come from a nomral distribution
  can be approximated by the power of a normal simultaneous prediction
  interval (see <code><a href="predIntNormSimultaneousTestPower.html">predIntNormSimultaneousTestPower</a></code>) where the multiplier
  \(K\) is replaced with the expected value of the normal order statistic that
  corresponds to the rank of the order statistic used for the upper or lower bound
  of the prediction interval.  Gansecki (2009) uses the approximation:
  $$K = \Phi^{-1}(\frac{i - 0.5}{n}) \;\;\;\;\;\; (8)$$
  where \(\Phi\) denotes the cumulative distribution function of the standard
  normal distribution and \(i\) denotes the rank of the order statistic used
  as the prediction limit.  By default, the value of the argument <br><code>evNormOrdStats.method="royston"</code>, so the function
  <code>predIntNparSimultaneousTestPower</code> uses the exact value of the
  expected value of the normal order statistic in the call to
  <code><a href="evNormOrdStats.html">evNormOrdStatsScalar</a></code>.  You can change the
  method of computing the expected value of the normal order statistic by
  changing the value of the argument <code>evNormOrdStats.method</code>.
  <br></p>
<p><em>Power Based on Monte Carlo Simulation</em> (<code>method="simulate"</code>) <br>
  When <code>method="simulate"</code>, the power of the nonparametric simultaneous
  prediction interval is estimated based on a Monte Carlo simulation.  The argument
  <code>NMC</code> determines the number of Monte Carlo trials.  If <code>ci=TRUE</code>, a
  confidence interval for the power is created based on the <code>NMC</code> Monte Carlo
  estimates of power.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p>vector of values between 0 and 1 equal to the probability that
  the rule will be violated.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>See the help file for <code><a href="predIntNparSimultaneous.html">predIntNparSimultaneous</a></code>.</p>
<p>Gansecki, M. (2009).  <em>Using the Optimal Rank Values Calculator</em>.
  US Environmental Protection Agency, Region 8, March 10, 2009.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Steven P. Millard (<a href="mailto:EnvStats@ProbStatInfo.com">EnvStats@ProbStatInfo.com</a>)</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>See the help file for <code><a href="predIntNparSimultaneous.html">predIntNparSimultaneous</a></code>.</p>
<p>In the course of designing a sampling program, an environmental scientist may wish
  to determine the relationship between sample size, significance level, power, and
  scaled difference if one of the objectives of the sampling program is to determine
  whether two distributions differ from each other.  The functions
  <code>predIntNparSimultaneousTestPower</code> and <br><code><a href="plotPredIntNparSimultaneousTestPowerCurve.html">plotPredIntNparSimultaneousTestPowerCurve</a></code> can be
  used to investigate these relationships for the case of normally-distributed
  observations.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="plotPredIntNparSimultaneousTestPowerCurve.html">plotPredIntNparSimultaneousTestPowerCurve</a></code>,
  <code><a href="predIntNparSimultaneous.html">predIntNparSimultaneous</a></code>, <br><code><a href="predIntNparSimultaneousN.html">predIntNparSimultaneousN</a></code>,
  <code><a href="predIntNparSimultaneousConfLevel.html">predIntNparSimultaneousConfLevel</a></code>, <br><code><a href="plotPredIntNparSimultaneousDesign.html">plotPredIntNparSimultaneousDesign</a></code>,
  <code><a href="predIntNpar.html">predIntNpar</a></code>, <code><a href="tolIntNpar.html">tolIntNpar</a></code>.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span>  <span class="co"># Example 19-5 of USEPA (2009, p. 19-33) shows how to compute nonparametric upper </span></span></span>
<span class="r-in"><span>  <span class="co"># simultaneous prediction limits for various rules based on trace mercury data (ppb) </span></span></span>
<span class="r-in"><span>  <span class="co"># collected in the past year from a site with four background wells and 10 compliance </span></span></span>
<span class="r-in"><span>  <span class="co"># wells (data for two of the compliance wells  are shown in the guidance document).  </span></span></span>
<span class="r-in"><span>  <span class="co"># The facility must monitor the 10 compliance wells for five constituents </span></span></span>
<span class="r-in"><span>  <span class="co"># (including mercury) annually.</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Here we will compute the confidence levels and powers associated with  </span></span></span>
<span class="r-in"><span>  <span class="co"># two different sampling plans: </span></span></span>
<span class="r-in"><span>  <span class="co"># 1) the 1-of-2 retesting plan for a median of order 3 using the </span></span></span>
<span class="r-in"><span>  <span class="co">#    background maximum and </span></span></span>
<span class="r-in"><span>  <span class="co"># 2) the 1-of-4 plan on individual observations using the 3rd highest </span></span></span>
<span class="r-in"><span>  <span class="co">#    background value.</span></span></span>
<span class="r-in"><span>  <span class="co"># Power will be computed assuming a normal distribution and setting </span></span></span>
<span class="r-in"><span>  <span class="co"># delta.over.sigma equal to 2, 3, and 4.</span></span></span>
<span class="r-in"><span>  <span class="co"># The data for this example are stored in EPA.09.Ex.19.5.mercury.df.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># We will pool data from 4 background wells that were sampled on </span></span></span>
<span class="r-in"><span>  <span class="co"># a number of different occasions, giving us a sample size of </span></span></span>
<span class="r-in"><span>  <span class="co"># n = 20 to use to construct the prediction limit.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># There are 10 compliance wells and we will monitor 5 different </span></span></span>
<span class="r-in"><span>  <span class="co"># constituents at each well annually.  For this example, USEPA (2009) </span></span></span>
<span class="r-in"><span>  <span class="co"># recommends setting r to the product of the number of compliance wells and </span></span></span>
<span class="r-in"><span>  <span class="co"># the number of evaluations per year.  </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># To determine the minimum confidence level we require for </span></span></span>
<span class="r-in"><span>  <span class="co"># the simultaneous prediction interval, USEPA (2009) recommends </span></span></span>
<span class="r-in"><span>  <span class="co"># setting the maximum allowed individual Type I Error level per constituent to:</span></span></span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span>  <span class="co"># 1 - (1 - SWFPR)^(1 / Number of Constituents)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># which translates to setting the confidence limit to </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># (1 - SWFPR)^(1 / Number of Constituents)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># where SWFPR = site-wide false positive rate.  For this example, we </span></span></span>
<span class="r-in"><span>  <span class="co"># will set SWFPR = 0.1.  Thus, the required individual Type I Error level </span></span></span>
<span class="r-in"><span>  <span class="co"># and confidence level per constituent are given as follows:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># n  = 20 based on 4 Background Wells</span></span></span>
<span class="r-in"><span>  <span class="co"># nw = 10 Compliance Wells</span></span></span>
<span class="r-in"><span>  <span class="co"># nc =  5 Constituents</span></span></span>
<span class="r-in"><span>  <span class="co"># ne =  1 Evaluation per year</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">n</span>  <span class="op">&lt;-</span> <span class="fl">20</span></span></span>
<span class="r-in"><span>  <span class="va">nw</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span>  <span class="va">nc</span> <span class="op">&lt;-</span>  <span class="fl">5</span></span></span>
<span class="r-in"><span>  <span class="va">ne</span> <span class="op">&lt;-</span>  <span class="fl">1</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Set number of future sampling occasions r to </span></span></span>
<span class="r-in"><span>  <span class="co"># Number Compliance Wells x Number Evaluations per Year</span></span></span>
<span class="r-in"><span>  <span class="va">r</span>  <span class="op">&lt;-</span>  <span class="va">nw</span> <span class="op">*</span> <span class="va">ne</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">conf.level</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">nc</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">conf.level</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9791484</span>
<span class="r-in"><span>  <span class="co">#[1] 0.9791484</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># So the required confidence level is 0.98, or 98%.</span></span></span>
<span class="r-in"><span>  <span class="co"># Now determine the confidence level associated with each plan.</span></span></span>
<span class="r-in"><span>  <span class="co"># Note that both plans achieve the required confidence level.</span></span></span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span>  <span class="co"># 1) the 1-of-2 retesting plan for a median of order 3 using the </span></span></span>
<span class="r-in"><span>  <span class="co">#    background maximum</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="predIntNparSimultaneousConfLevel.html">predIntNparSimultaneousConfLevel</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">20</span>, n.median <span class="op">=</span> <span class="fl">3</span>, k <span class="op">=</span> <span class="fl">1</span>, m <span class="op">=</span> <span class="fl">2</span>, r <span class="op">=</span> <span class="va">r</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9940354</span>
<span class="r-in"><span>  <span class="co">#[1] 0.9940354</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># 2) the 1-of-4 plan based on individual observations using the 3rd highest </span></span></span>
<span class="r-in"><span>  <span class="co">#    background value.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="predIntNparSimultaneousConfLevel.html">predIntNparSimultaneousConfLevel</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">20</span>, k <span class="op">=</span> <span class="fl">1</span>, m <span class="op">=</span> <span class="fl">4</span>, r <span class="op">=</span> <span class="va">r</span>, </span></span>
<span class="r-in"><span>    n.plus.one.minus.upl.rank <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9864909</span>
<span class="r-in"><span>  <span class="co">#[1] 0.9864909</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#------------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span>  <span class="co"># Compute approximate power of each plan to detect contamination at just 1 well </span></span></span>
<span class="r-in"><span>  <span class="co"># assuming true underying distribution of Hg is Normal at all wells and </span></span></span>
<span class="r-in"><span>  <span class="co"># using delta.over.sigma equal to 2, 3, and 4.</span></span></span>
<span class="r-in"><span>  <span class="co">#------------------------------------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Computer aproximate power for </span></span></span>
<span class="r-in"><span>  <span class="co"># 1) the 1-of-2 retesting plan for a median of order 3 using the </span></span></span>
<span class="r-in"><span>  <span class="co">#    background maximum</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu">predIntNparSimultaneousTestPower</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">20</span>, n.median <span class="op">=</span> <span class="fl">3</span>, k <span class="op">=</span> <span class="fl">1</span>, m <span class="op">=</span> <span class="fl">2</span>, r <span class="op">=</span> <span class="va">r</span>, </span></span>
<span class="r-in"><span>    delta.over.sigma <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, r.shifted <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.3953712 0.9129671 0.9983054</span>
<span class="r-in"><span>  <span class="co">#[1] 0.3953712 0.9129671 0.9983054</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Compute approximate power for</span></span></span>
<span class="r-in"><span>  <span class="co"># 2) the 1-of-4 plan based on individual observations using the 3rd highest </span></span></span>
<span class="r-in"><span>  <span class="co">#    background value.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu">predIntNparSimultaneousTestPower</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">20</span>, k <span class="op">=</span> <span class="fl">1</span>, m <span class="op">=</span> <span class="fl">4</span>, r <span class="op">=</span> <span class="va">r</span>, </span></span>
<span class="r-in"><span>    n.plus.one.minus.upl.rank <span class="op">=</span> <span class="fl">3</span>, delta.over.sigma <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, r.shifted <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.4367972 0.8694664 0.9888779</span>
<span class="r-in"><span>  <span class="co">#[1] 0.4367972 0.8694664 0.9888779</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#----------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="co"># Compare estimated power using approximation method with estimated power</span></span></span>
<span class="r-in"><span>  <span class="co"># using Monte Carlo simulation for the 1-of-4 plan based on individual </span></span></span>
<span class="r-in"><span>  <span class="co"># observations using the 3rd highest background value.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu">predIntNparSimultaneousTestPower</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">20</span>, k <span class="op">=</span> <span class="fl">1</span>, m <span class="op">=</span> <span class="fl">4</span>, r <span class="op">=</span> <span class="va">r</span>, </span></span>
<span class="r-in"><span>    n.plus.one.minus.upl.rank <span class="op">=</span> <span class="fl">3</span>, delta.over.sigma <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, r.shifted <span class="op">=</span> <span class="fl">1</span>, </span></span>
<span class="r-in"><span>    method <span class="op">=</span> <span class="st">"simulate"</span>, ci <span class="op">=</span> <span class="cn">TRUE</span>, NMC <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">#[1] 0.437 0.863 0.989</span></span></span>
<span class="r-in"><span>  <span class="co">#attr(,"conf.int")</span></span></span>
<span class="r-in"><span>  <span class="co">#         [,1]      [,2]      [,3]</span></span></span>
<span class="r-in"><span>  <span class="co">#LCL 0.4111999 0.8451148 0.9835747</span></span></span>
<span class="r-in"><span>  <span class="co">#UCL 0.4628001 0.8808852 0.9944253</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span>  <span class="co">#==========</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Cleanup</span></span></span>
<span class="r-in"><span>  <span class="co">#--------</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">nw</span>, <span class="va">nc</span>, <span class="va">ne</span>, <span class="va">r</span>, <span class="va">conf.level</span><span class="op">)</span> </span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Steven P. Millard, Alexander Kowarik.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

